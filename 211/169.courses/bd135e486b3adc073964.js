webpackJsonp([169],{169:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r){for(var i=new PIXI.Container,s=new PIXI.filters.ColorMatrixFilter,a=n||!1,l=r||{addArrow:!1,type:"horizontal",scale:1},o=new PIXI.Container,c=0;c<3;++c){var h=c+1,u=PIXI.Sprite.fromFrame("TAP_1"+h);u.x=-u.width/2,u.y=-u.height/2;var f=new PIXI.Container;f.addChild(u),o.addChild(f)}var m=0;if(l.direction)switch(l.direction){case"top":m=-Math.PI/2;break;case"bottom":m=Math.PI/2;break;case"left":m=Math.PI;break;case"right":m=0;break;default:m=0}o.filters=[s];for(var d=0;d<o.children.length;d++){var p=o.children[d];p.scale.x=p.scale.y=2,d<2&&b(p,.75*d)}if(i.addChild(o),l.addArrow){var v,g;if(l.direction){v=PIXI.Sprite.fromFrame("oneArrow"),g=new PIXI.extras.MovieClip([v]);var x=l.scale?l.scale:1;g.scale.x=g.scale.y=x,g.pivot={x:0,y:g.height/2},g.rotation=m}else{v=PIXI.Sprite.fromFrame("NBarrow"),(g=new PIXI.extras.MovieClip([v])).pivot={x:g.width/2,y:g.height/2};var M=l.scale?l.scale:1;g.scale.x=g.scale.y=M,"horizontal"!==(l.type?l.type:"horizontal")&&(g.rotation=Math.PI/2)}i.addChild(g),i.arrow=g,i.addEventListener("hideArrow",function(){g.alpha=0,g.visible=!1}),i.addEventListener("showArrow",function(){g.alpha=1,g.visible=!0})}o.alpha=.4;var V=new PIXI.Graphics;function b(e,t){TweenMax.to(e,1.5,{delay:t,alpha:0,repeat:-1}),TweenMax.to(e.scale,1.5,{x:5,y:5,delay:t,repeat:-1})}return V.beginFill(16776960,0),V.drawRect(-50,-50,100,100),i.addChild(V),i.addEventListener(MouseEvent.MOUSE_OVER,function(){o.alpha=.6}),i.addEventListener(MouseEvent.MOUSE_OUT,function(){o.alpha=.4}),i.addEventListener(TouchEvent.TOUCH_BEGIN,function(){i.emit(i.event.TAP),!a&&i.parent&&i.parent.removeChild(i)}),i.x=e,i.y=t,i.setColor=function(e){var t=e>>16,n=e>>8&255,r=255&e;s._loadMatrix([t,0,0,0,0,0,n,0,0,0,0,0,r,0,0,0,0,0,255,0],!1),o.filters=[s]},i.setRotation=function(e){i.rotation=e},i.showAllDir=function(){if(l.direction)for(var e=0;e<3;e++){var t=new PIXI.Container;t.addChild(PIXI.Sprite.fromFrame("oneArrow")),i.addChild(t),t.pivot={x:0,y:g.height/2},t.rotation=Math.PI/2*(e+1)}else{var n=new PIXI.Container;n.addChild(PIXI.Sprite.fromFrame("NBarrow")),i.addChild(n),n.pivot={x:g.width/2,y:g.height/2},n.rotation=i.rotation+Math.PI/2}},i.event={TAP:"pointTap",HIDEARR:"hideArrow",SHOWARR:"showArrow"},instance.info&&instance.info.newLayOut&&i.scale.set(.6,.6),i}},281:function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(n(169));nb.substance0013=extendsClass(ScienceMain,{frame0:function(){var e=n(553),t=new nb.Box2d(this),i=new PIXI.Graphics;this.addChild(i);var s=this,a=this.blance.width;s.blanceRef.visible=!1;var l,o=$s(10),c=!1,h=!1,u=void 0,f=s.ball,m=s.blance;p(),instance.NBDownTip.showTip(instance.info.OPERATION_0),f.addEventListener(TouchEvent.TAP,function(){f._addpoint&&f.removeChild(f._addpoint),void 0===u&&(u=!0),instance.NBDownTip.hideTip()}),this.onUpdate=function(){t.render();var n=s.blance.rotation;if(s.ball.isDragging)if(s.ball.y-$s(600)<s.blance.y){i.clear(),i.lineStyle($s(4),16711680,.2);var r=e.create([s.ball.x,s.ball.y],[0,1]),f=e.create([s.blance.x,s.blance.y],[Math.cos(n),Math.sin(n)]);l=f.intersectionWith(r),s.blanceRef.x=l.elements[0],s.blanceRef.y=l.elements[1]+o,s.blanceRef.rotation=n,s.blanceRef.visible=!0;var v=Math.cos(n)*a/2;l.elements[0]>s.blance.x-v&&l.elements[0]<s.blance.x+v?(d(!0),i.moveTo(s.ball.x,s.ball.y),i.lineTo(l.elements[0],l.elements[1])):(d(!1),i.clear(),s.blanceRef.visible=!1,l=null)}else d(!1),i.clear(),s.blanceRef.visible=!1,l=null;else{var g=nb.Box2d.getBodyJoint(s.ball,b2DistanceJoint);if(g){var x=new b2Vec2;g.GetAnchorB(x),s.blanceRef.x=x.x*t.b2Scale,s.blanceRef.y=x.y*t.b2Scale,s.blanceRef.rotation=n;var M=NBPoint.distance(s.blanceRef,s.blance);M>$s(186)&&M<$s(196)&&(t.removeDrag(s.ball),c=!0)}}if(u){if(m.lastRotation){var V=m.rotation-m.lastRotation;Math.abs(V)<1e-4&&(h=!0),m.lastRotation=m.rotation}else m.lastRotation=m.rotation;h&&Math.abs(m.rotation)>.2&&(u=!1,p(),instance.NBDownTip.showTip(instance.info.OPERATION_1),s.ball.interactive=!0)}},this.ball.on(NBDrag.event.START_DRAG,function(){nb.Box2d.destoryBodyJoint(this.b2Body,[b2DistanceJoint,b2RopeJoint])}),this.ball.on(NBDrag.event.STOP_DRAG,function(){i.clear(),d(!1),null!==l&&(t.createDistanceJoint(this,s.blanceRef),l=null)});var d=function(e){!0===e?s.blance.b2Body.SetType(b2Body.b2_staticBody):s.blance.b2Body.SetType(b2Body.b2_dynamicBody)};function p(){var e=f.tap,t=e.x,n=e.y,i=(0,r.default)(t,n);f.addChild(i),f._addpoint=i}t.createDistanceJoint(this.ball,s.blanceRef);var v=!1;this.ball.on(TouchEvent.TAP,function(){s.ball.interactive=!1,0==v?(c&&0===this.ani.currentFrame&&(TweenMax.to(s.ball.ani,.5,{currentFrame:s.ball.ani.totalFrames-1,onComplete:function(){s.ball.interactive=!0}}),nb.Box2d.setMass(this.b2Body,1.05*this.b2Body.m_mass)),v=!0):(v=!1,TweenMax.to(s.ball.ani,.5,{currentFrame:0,onComplete:function(){s.ball.interactive=!0}}),nb.Box2d.setMass(this.b2Body,this.b2Body.m_mass/1.05))}),s.blanceRef.visible=!0},start:function(){this.bindScriptToSprite(this.frame0,"frame0")},info:{experimentImport:"我们已经知道空气确实存在，和水、石头等一样，可以占据空间，那想一想空气有重量吗？",labName:"空气有重量吗",title0:"在平衡的小天平上点击瘪气的气球使气球充满空气并观察现象，等待稳定后，再次点击可以抽取空气再次观察",CONCLUSION:"空气有一定重量，但重量很轻。",OPERATION_0:"点击气球注入空气",OPERATION_1:"排除空气观察现象"},const:{MATCH:"Match"},event:{}}),e.exports=nb.substance0013},553:function(e,t,n){var r={precision:1e-6,Vector:function(){}};r.Vector.create=function(e){return(new r.Vector).setElements(e)};r.Vector.create;r.Vector.Random=function(e){for(var t=[];e--;)t.push(Math.random());return r.Vector.create(t)},r.Vector.Zero=function(e){for(var t=[];e--;)t.push(0);return r.Vector.create(t)},r.Vector.prototype={e:function(e){return e<1||e>this.elements.length?null:this.elements[e-1]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(e){var t=this.elements.length,n=e.elements||e;if(t!==n.length)return!1;for(;t--;)if(Math.abs(this.elements[t]-n[t])>r.precision)return!1;return!0},dup:function(){return r.Vector.create(this.elements)},map:function(e,t){var n=[];return this.each(function(r,i){n.push(e.call(t,r,i))}),r.Vector.create(n)},forEach:function(e,t){for(var n=this.elements.length,r=0;r<n;r++)e.call(t,this.elements[r],r+1)},toUnitVector:function(){var e=this.modulus();return 0===e?this.dup():this.map(function(t){return t/e})},angleFrom:function(e){var t=e.elements||e,n=this.elements.length;if(n!==t.length)return null;var r=0,i=0,s=0;if(this.each(function(e,n){r+=e*t[n-1],i+=e*e,s+=t[n-1]*t[n-1]}),i=Math.sqrt(i),s=Math.sqrt(s),i*s==0)return null;var a=r/(i*s);return a<-1&&(a=-1),a>1&&(a=1),Math.acos(a)},isParallelTo:function(e){var t=this.angleFrom(e);return null===t?null:t<=r.precision},isAntiparallelTo:function(e){var t=this.angleFrom(e);return null===t?null:Math.abs(t-Math.PI)<=r.precision},isPerpendicularTo:function(e){var t=this.dot(e);return null===t?null:Math.abs(t)<=r.precision},add:function(e){var t=e.elements||e;return this.elements.length!==t.length?null:this.map(function(e,n){return e+t[n-1]})},subtract:function(e){var t=e.elements||e;return this.elements.length!==t.length?null:this.map(function(e,n){return e-t[n-1]})},multiply:function(e){return this.map(function(t){return t*e})},dot:function(e){var t=e.elements||e,n=0,r=this.elements.length;if(r!==t.length)return null;for(;r--;)n+=this.elements[r]*t[r];return n},cross:function(e){var t=e.elements||e;if(3!==this.elements.length||3!==t.length)return null;var n=this.elements;return r.Vector.create([n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]])},max:function(){for(var e=0,t=this.elements.length;t--;)Math.abs(this.elements[t])>Math.abs(e)&&(e=this.elements[t]);return e},indexOf:function(e){for(var t=null,n=this.elements.length,r=0;r<n;r++)null===t&&this.elements[r]===e&&(t=r+1);return t},toDiagonalMatrix:function(){return r.Matrix.Diagonal(this.elements)},round:function(){return this.map(function(e){return Math.round(e)})},snapTo:function(e){return this.map(function(t){return Math.abs(t-e)<=r.precision?e:t})},distanceFrom:function(e){if(e.anchor||e.start&&e.end)return e.distanceFrom(this);var t=e.elements||e;if(t.length!==this.elements.length)return null;var n,r=0;return this.each(function(e,i){n=e-t[i-1],r+=n*n}),Math.sqrt(r)},liesOn:function(e){return e.contains(this)},liesIn:function(e){return e.contains(this)},rotate:function(e,t){var n,i,s,a,l=null;switch(e.determinant&&(l=e.elements),this.elements.length){case 2:return 2!==(n=t.elements||t).length?null:(l||(l=r.Matrix.Rotation(e).elements),i=this.elements[0]-n[0],s=this.elements[1]-n[1],r.Vector.create([n[0]+l[0][0]*i+l[0][1]*s,n[1]+l[1][0]*i+l[1][1]*s]));case 3:if(!t.direction)return null;var o=t.pointClosestTo(this).elements;return l||(l=r.Matrix.Rotation(e,t.direction).elements),i=this.elements[0]-o[0],s=this.elements[1]-o[1],a=this.elements[2]-o[2],r.Vector.create([o[0]+l[0][0]*i+l[0][1]*s+l[0][2]*a,o[1]+l[1][0]*i+l[1][1]*s+l[1][2]*a,o[2]+l[2][0]*i+l[2][1]*s+l[2][2]*a]);default:return null}},reflectionIn:function(e){if(e.anchor){var t=this.elements.slice(),n=e.pointClosestTo(t).elements;return r.Vector.create([n[0]+(n[0]-t[0]),n[1]+(n[1]-t[1]),n[2]+(n[2]-(t[2]||0))])}var i=e.elements||e;return this.elements.length!==i.length?null:this.map(function(e,t){return i[t-1]+(i[t-1]-e)})},to3D:function(){var e=this.dup();switch(e.elements.length){case 3:break;case 2:e.elements.push(0);break;default:return null}return e},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(e){return this.elements=(e.elements||e).slice(),this}},r.Vector.prototype.x=r.Vector.prototype.multiply,r.Vector.prototype.each=r.Vector.prototype.forEach,r.Vector.i=r.Vector.create([1,0,0]),r.Vector.j=r.Vector.create([0,1,0]),r.Vector.k=r.Vector.create([0,0,1]),r.Matrix=function(){},r.Matrix.create=function(e){return(new r.Matrix).setElements(e)};r.Matrix.create;r.Matrix.I=function(e){for(var t,n=[],i=e;i--;)for(t=e,n[i]=[];t--;)n[i][t]=i===t?1:0;return r.Matrix.create(n)},r.Matrix.Diagonal=function(e){for(var t=e.length,n=r.Matrix.I(t);t--;)n.elements[t][t]=e[t];return n},r.Matrix.Rotation=function(e,t){if(!t)return r.Matrix.create([[Math.cos(e),-Math.sin(e)],[Math.sin(e),Math.cos(e)]]);var n=t.dup();if(3!==n.elements.length)return null;var i=n.modulus(),s=n.elements[0]/i,a=n.elements[1]/i,l=n.elements[2]/i,o=Math.sin(e),c=Math.cos(e),h=1-c;return r.Matrix.create([[h*s*s+c,h*s*a-o*l,h*s*l+o*a],[h*s*a+o*l,h*a*a+c,h*a*l-o*s],[h*s*l-o*a,h*a*l+o*s,h*l*l+c]])},r.Matrix.RotationX=function(e){var t=Math.cos(e),n=Math.sin(e);return r.Matrix.create([[1,0,0],[0,t,-n],[0,n,t]])},r.Matrix.RotationY=function(e){var t=Math.cos(e),n=Math.sin(e);return r.Matrix.create([[t,0,n],[0,1,0],[-n,0,t]])},r.Matrix.RotationZ=function(e){var t=Math.cos(e),n=Math.sin(e);return r.Matrix.create([[t,-n,0],[n,t,0],[0,0,1]])},r.Matrix.Random=function(e,t){return r.Matrix.Zero(e,t).map(function(){return Math.random()})},r.Matrix.Zero=function(e,t){for(var n,i=[],s=e;s--;)for(n=t,i[s]=[];n--;)i[s][n]=0;return r.Matrix.create(i)},r.Matrix.prototype={e:function(e,t){return e<1||e>this.elements.length||t<1||t>this.elements[0].length?null:this.elements[e-1][t-1]},row:function(e){return e>this.elements.length?null:r.Vector.create(this.elements[e-1])},col:function(e){if(0===this.elements.length)return null;if(e>this.elements[0].length)return null;for(var t=[],n=this.elements.length,i=0;i<n;i++)t.push(this.elements[i][e-1]);return r.Vector.create(t)},dimensions:function(){var e=0===this.elements.length?0:this.elements[0].length;return{rows:this.elements.length,cols:e}},rows:function(){return this.elements.length},cols:function(){return 0===this.elements.length?0:this.elements[0].length},eql:function(e){var t=e.elements||e;if(t[0]&&void 0!==t[0][0]||(t=r.Matrix.create(t).elements),0===this.elements.length||0===t.length)return this.elements.length===t.length;if(this.elements.length!==t.length)return!1;if(this.elements[0].length!==t[0].length)return!1;for(var n,i=this.elements.length,s=this.elements[0].length;i--;)for(n=s;n--;)if(Math.abs(this.elements[i][n]-t[i][n])>r.precision)return!1;return!0},dup:function(){return r.Matrix.create(this.elements)},map:function(e,t){if(0===this.elements.length)return r.Matrix.create([]);for(var n,i=[],s=this.elements.length,a=this.elements[0].length;s--;)for(n=a,i[s]=[];n--;)i[s][n]=e.call(t,this.elements[s][n],s+1,n+1);return r.Matrix.create(i)},isSameSizeAs:function(e){var t=e.elements||e;return void 0===t[0][0]&&(t=r.Matrix.create(t).elements),0===this.elements.length?0===t.length:this.elements.length===t.length&&this.elements[0].length===t[0].length},add:function(e){if(0===this.elements.length)return this.map(function(e){return e});var t=e.elements||e;return void 0===t[0][0]&&(t=r.Matrix.create(t).elements),this.isSameSizeAs(t)?this.map(function(e,n,r){return e+t[n-1][r-1]}):null},subtract:function(e){if(0===this.elements.length)return this.map(function(e){return e});var t=e.elements||e;return void 0===t[0][0]&&(t=r.Matrix.create(t).elements),this.isSameSizeAs(t)?this.map(function(e,n,r){return e-t[n-1][r-1]}):null},canMultiplyFromLeft:function(e){if(0===this.elements.length)return!1;var t=e.elements||e;return void 0===t[0][0]&&(t=r.Matrix.create(t).elements),this.elements[0].length===t.length},multiply:function(e){if(0===this.elements.length)return null;if(!e.elements)return this.map(function(t){return t*e});var t=!!e.modulus;if(void 0===(h=e.elements||e)[0][0]&&(h=r.Matrix.create(h).elements),!this.canMultiplyFromLeft(h))return null;for(var n,i,s,a=this.elements.length,l=h[0].length,o=this.elements[0].length,c=[];a--;)for(n=l,c[a]=[];n--;){for(i=o,s=0;i--;)s+=this.elements[a][i]*h[i][n];c[a][n]=s}var h=r.Matrix.create(c);return t?h.col(1):h},minor:function(e,t,n,i){if(0===this.elements.length)return null;for(var s,a,l,o=[],c=n,h=this.elements.length,u=this.elements[0].length;c--;)for(o[s=n-c-1]=[],a=i;a--;)l=i-a-1,o[s][l]=this.elements[(e+s-1)%h][(t+l-1)%u];return r.Matrix.create(o)},transpose:function(){if(0===this.elements.length)return r.Matrix.create([]);for(var e,t=this.elements.length,n=[],i=this.elements[0].length;i--;)for(e=t,n[i]=[];e--;)n[i][e]=this.elements[e][i];return r.Matrix.create(n)},isSquare:function(){var e=0===this.elements.length?0:this.elements[0].length;return this.elements.length===e},max:function(){if(0===this.elements.length)return null;for(var e,t=0,n=this.elements.length,r=this.elements[0].length;n--;)for(e=r;e--;)Math.abs(this.elements[n][e])>Math.abs(t)&&(t=this.elements[n][e]);return t},indexOf:function(e){if(0===this.elements.length)return null;var t,n,r=this.elements.length,i=this.elements[0].length;for(t=0;t<r;t++)for(n=0;n<i;n++)if(this.elements[t][n]===e)return{i:t+1,j:n+1};return null},diagonal:function(){if(!this.isSquare)return null;for(var e=[],t=this.elements.length,n=0;n<t;n++)e.push(this.elements[n][n]);return r.Vector.create(e)},toRightTriangular:function(){if(0===this.elements.length)return r.Matrix.create([]);var e,t,n,i,s=this.dup(),a=this.elements.length,l=this.elements[0].length;for(t=0;t<a;t++){if(0===s.elements[t][t])for(n=t+1;n<a;n++)if(0!==s.elements[n][t]){for(e=[],i=0;i<l;i++)e.push(s.elements[t][i]+s.elements[n][i]);s.elements[t]=e;break}if(0!==s.elements[t][t])for(n=t+1;n<a;n++){var o=s.elements[n][t]/s.elements[t][t];for(e=[],i=0;i<l;i++)e.push(i<=t?0:s.elements[n][i]-s.elements[t][i]*o);s.elements[n]=e}}return s},determinant:function(){if(0===this.elements.length)return 1;if(!this.isSquare())return null;for(var e=this.toRightTriangular(),t=e.elements[0][0],n=e.elements.length,r=1;r<n;r++)t*=e.elements[r][r];return t},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(0===this.elements.length)return 0;if(!this.isSquare())return null;for(var e=this.elements[0][0],t=this.elements.length,n=1;n<t;n++)e+=this.elements[n][n];return e},rank:function(){if(0===this.elements.length)return 0;for(var e,t=this.toRightTriangular(),n=0,i=this.elements.length,s=this.elements[0].length;i--;)for(e=s;e--;)if(Math.abs(t.elements[i][e])>r.precision){n++;break}return n},augment:function(e){if(0===this.elements.length)return this.dup();var t=e.elements||e;void 0===t[0][0]&&(t=r.Matrix.create(t).elements);var n,i=this.dup(),s=i.elements[0].length,a=i.elements.length,l=t[0].length;if(a!==t.length)return null;for(;a--;)for(n=l;n--;)i.elements[a][s+n]=t[a][n];return i},inverse:function(){if(0===this.elements.length)return null;if(!this.isSquare()||this.isSingular())return null;for(var e,t,n,i,s,a=this.elements.length,l=a,o=this.augment(r.Matrix.I(a)).toRightTriangular(),c=o.elements[0].length,h=[];l--;){for(n=[],h[l]=[],i=o.elements[l][l],t=0;t<c;t++)s=o.elements[l][t]/i,n.push(s),t>=a&&h[l].push(s);for(o.elements[l]=n,e=l;e--;){for(n=[],t=0;t<c;t++)n.push(o.elements[e][t]-o.elements[l][t]*o.elements[e][l]);o.elements[e]=n}}return r.Matrix.create(h)},round:function(){return this.map(function(e){return Math.round(e)})},snapTo:function(e){return this.map(function(t){return Math.abs(t-e)<=r.precision?e:t})},inspect:function(){var e=[],t=this.elements.length;if(0===t)return"[]";for(var n=0;n<t;n++)e.push(r.Vector.create(this.elements[n]).inspect());return e.join("\n")},setElements:function(e){var t,n,r=e.elements||e;if(r[0]&&void 0!==r[0][0]){for(t=r.length,this.elements=[];t--;)for(n=r[t].length,this.elements[t]=[];n--;)this.elements[t][n]=r[t][n];return this}var i=r.length;for(this.elements=[],t=0;t<i;t++)this.elements.push([r[t]]);return this}},r.Matrix.prototype.toUpperTriangular=r.Matrix.prototype.toRightTriangular,r.Matrix.prototype.det=r.Matrix.prototype.determinant,r.Matrix.prototype.tr=r.Matrix.prototype.trace,r.Matrix.prototype.rk=r.Matrix.prototype.rank,r.Matrix.prototype.inv=r.Matrix.prototype.inverse,r.Matrix.prototype.x=r.Matrix.prototype.multiply,r.Line=function(){},r.Line.prototype={eql:function(e){return this.isParallelTo(e)&&this.contains(e.anchor)},dup:function(){return r.Line.create(this.anchor,this.direction)},translate:function(e){var t=e.elements||e;return r.Line.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.direction)},isParallelTo:function(e){if(e.normal||e.start&&e.end)return e.isParallelTo(this);var t=this.direction.angleFrom(e.direction);return Math.abs(t)<=r.precision||Math.abs(t-Math.PI)<=r.precision},distanceFrom:function(e){if(e.normal||e.start&&e.end)return e.distanceFrom(this);if(e.direction){if(this.isParallelTo(e))return this.distanceFrom(e.anchor);var t=this.direction.cross(e.direction).toUnitVector().elements,n=this.anchor.elements,r=e.anchor.elements;return Math.abs((n[0]-r[0])*t[0]+(n[1]-r[1])*t[1]+(n[2]-r[2])*t[2])}var i=e.elements||e,s=(n=this.anchor.elements,this.direction.elements),a=i[0]-n[0],l=i[1]-n[1],o=(i[2]||0)-n[2],c=Math.sqrt(a*a+l*l+o*o);if(0===c)return 0;var h=(a*s[0]+l*s[1]+o*s[2])/c,u=1-h*h;return Math.abs(c*Math.sqrt(u<0?0:u))},contains:function(e){if(e.start&&e.end)return this.contains(e.start)&&this.contains(e.end);var t=this.distanceFrom(e);return null!==t&&t<=r.precision},positionOf:function(e){if(!this.contains(e))return null;var t=e.elements||e,n=this.anchor.elements,r=this.direction.elements;return(t[0]-n[0])*r[0]+(t[1]-n[1])*r[1]+((t[2]||0)-n[2])*r[2]},liesIn:function(e){return e.contains(this)},intersects:function(e){return e.normal?e.intersects(this):!this.isParallelTo(e)&&this.distanceFrom(e)<=r.precision},intersectionWith:function(e){if(e.normal||e.start&&e.end)return e.intersectionWith(this);if(!this.intersects(e))return null;var t=this.anchor.elements,n=this.direction.elements,i=e.anchor.elements,s=e.direction.elements,a=n[0],l=n[1],o=n[2],c=s[0],h=s[1],u=s[2],f=t[0]-i[0],m=t[1]-i[1],d=t[2]-i[2],p=c*c+h*h+u*u,v=a*c+l*h+o*u,g=((-a*f-l*m-o*d)*p/(a*a+l*l+o*o)+v*(c*f+h*m+u*d))/(p-v*v);return r.Vector.create([t[0]+g*a,t[1]+g*l,t[2]+g*o])},pointClosestTo:function(e){if(e.start&&e.end)return null===(u=e.pointClosestTo(this))?null:this.pointClosestTo(u);if(e.direction){if(this.intersects(e))return this.intersectionWith(e);if(this.isParallelTo(e))return null;var t=this.direction.elements,n=e.direction.elements,i=t[0],s=t[1],a=t[2],l=n[0],o=n[1],c=n[2],h=[(v=a*l-i*c)*c-(g=i*o-s*l)*o,g*l-(x=s*c-a*o)*c,x*o-v*l];return(u=r.Plane.create(e.anchor,h)).intersectionWith(this)}var u=e.elements||e;if(this.contains(u))return r.Vector.create(u);var f=this.anchor.elements,m=(i=(t=this.direction.elements)[0],s=t[1],a=t[2],f[0]),d=f[1],p=f[2],v=i*(u[1]-d)-s*(u[0]-m),g=s*((u[2]||0)-p)-a*(u[1]-d),x=a*(u[0]-m)-i*((u[2]||0)-p),M=r.Vector.create([s*v-a*x,a*g-i*v,i*x-s*g]),V=this.distanceFrom(u)/M.modulus();return r.Vector.create([u[0]+M.elements[0]*V,u[1]+M.elements[1]*V,(u[2]||0)+M.elements[2]*V])},rotate:function(e,t){void 0===t.direction&&(t=r.Line.create(t.to3D(),r.Vector.k));var n=r.Matrix.Rotation(e,t.direction).elements,i=t.pointClosestTo(this.anchor).elements,s=this.anchor.elements,a=this.direction.elements,l=i[0],o=i[1],c=i[2],h=s[0]-l,u=s[1]-o,f=s[2]-c;return r.Line.create([l+n[0][0]*h+n[0][1]*u+n[0][2]*f,o+n[1][0]*h+n[1][1]*u+n[1][2]*f,c+n[2][0]*h+n[2][1]*u+n[2][2]*f],[n[0][0]*a[0]+n[0][1]*a[1]+n[0][2]*a[2],n[1][0]*a[0]+n[1][1]*a[1]+n[1][2]*a[2],n[2][0]*a[0]+n[2][1]*a[1]+n[2][2]*a[2]])},reverse:function(){return r.Line.create(this.anchor,this.direction.x(-1))},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.direction.elements,i=t[0],s=t[1],a=t[2],l=n[0],o=n[1],c=n[2],h=this.anchor.reflectionIn(e).elements,u=i+l,f=s+o,m=a+c,d=e.pointClosestTo([u,f,m]).elements,p=[d[0]+(d[0]-u)-h[0],d[1]+(d[1]-f)-h[1],d[2]+(d[2]-m)-h[2]];return r.Line.create(h,p)}if(e.direction)return this.rotate(Math.PI,e);var v=e.elements||e;return r.Line.create(this.anchor.reflectionIn([v[0],v[1],v[2]||0]),this.direction)},setVectors:function(e,t){if(e=r.Vector.create(e),t=r.Vector.create(t),2===e.elements.length&&e.elements.push(0),2===t.elements.length&&t.elements.push(0),e.elements.length>3||t.elements.length>3)return null;var n=t.modulus();return 0===n?null:(this.anchor=e,this.direction=r.Vector.create([t.elements[0]/n,t.elements[1]/n,t.elements[2]/n]),this)}},r.Line.create=function(e,t){return(new r.Line).setVectors(e,t)};r.Line.create;r.Line.X=r.Line.create(r.Vector.Zero(3),r.Vector.i),r.Line.Y=r.Line.create(r.Vector.Zero(3),r.Vector.j),r.Line.Z=r.Line.create(r.Vector.Zero(3),r.Vector.k),r.Line.Segment=function(){},r.Line.Segment.prototype={eql:function(e){return this.start.eql(e.start)&&this.end.eql(e.end)||this.start.eql(e.end)&&this.end.eql(e.start)},dup:function(){return r.Line.Segment.create(this.start,this.end)},length:function(){var e=this.start.elements,t=this.end.elements,n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},toVector:function(){var e=this.start.elements,t=this.end.elements;return r.Vector.create([t[0]-e[0],t[1]-e[1],t[2]-e[2]])},midpoint:function(){var e=this.start.elements,t=this.end.elements;return r.Vector.create([(t[0]+e[0])/2,(t[1]+e[1])/2,(t[2]+e[2])/2])},bisectingPlane:function(){return r.Plane.create(this.midpoint(),this.toVector())},translate:function(e){var t=e.elements||e,n=this.start.elements,i=this.end.elements;return r.Line.Segment.create([n[0]+t[0],n[1]+t[1],n[2]+(t[2]||0)],[i[0]+t[0],i[1]+t[1],i[2]+(t[2]||0)])},isParallelTo:function(e){return this.line.isParallelTo(e)},distanceFrom:function(e){var t=this.pointClosestTo(e);return null===t?null:t.distanceFrom(e)},contains:function(e){if(e.start&&e.end)return this.contains(e.start)&&this.contains(e.end);var t=(e.elements||e).slice();if(2===t.length&&t.push(0),this.start.eql(t))return!0;var n=this.start.elements,i=r.Vector.create([n[0]-t[0],n[1]-t[1],n[2]-(t[2]||0)]),s=this.toVector();return i.isAntiparallelTo(s)&&i.modulus()<=s.modulus()},intersects:function(e){return null!==this.intersectionWith(e)},intersectionWith:function(e){if(!this.line.intersects(e))return null;var t=this.line.intersectionWith(e);return this.contains(t)?t:null},pointClosestTo:function(e){if(e.normal){var t=this.line.intersectionWith(e);return null===t?null:this.pointClosestTo(t)}var n=this.line.pointClosestTo(e);return null===n?null:this.contains(n)?n:(this.line.positionOf(n)<0?this.start:this.end).dup()},setPoints:function(e,t){return e=r.Vector.create(e).to3D(),t=r.Vector.create(t).to3D(),null===e||null===t?null:(this.line=r.Line.create(e,t.subtract(e)),this.start=e,this.end=t,this)}},r.Line.Segment.create=function(e,t){return(new r.Line.Segment).setPoints(e,t)},r.Plane=function(){},r.Plane.prototype={eql:function(e){return this.contains(e.anchor)&&this.isParallelTo(e)},dup:function(){return r.Plane.create(this.anchor,this.normal)},translate:function(e){var t=e.elements||e;return r.Plane.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.normal)},isParallelTo:function(e){var t;return e.normal?(t=this.normal.angleFrom(e.normal),Math.abs(t)<=r.precision||Math.abs(Math.PI-t)<=r.precision):e.direction?this.normal.isPerpendicularTo(e.direction):null},isPerpendicularTo:function(e){var t=this.normal.angleFrom(e.normal);return Math.abs(Math.PI/2-t)<=r.precision},distanceFrom:function(e){if(this.intersects(e)||this.contains(e))return 0;if(e.anchor){var t=this.anchor.elements,n=e.anchor.elements,r=this.normal.elements;return Math.abs((t[0]-n[0])*r[0]+(t[1]-n[1])*r[1]+(t[2]-n[2])*r[2])}var i=e.elements||e;t=this.anchor.elements,r=this.normal.elements;return Math.abs((t[0]-i[0])*r[0]+(t[1]-i[1])*r[1]+(t[2]-(i[2]||0))*r[2])},contains:function(e){if(e.normal)return null;if(e.direction)return this.contains(e.anchor)&&this.contains(e.anchor.add(e.direction));var t=e.elements||e,n=this.anchor.elements,i=this.normal.elements;return Math.abs(i[0]*(n[0]-t[0])+i[1]*(n[1]-t[1])+i[2]*(n[2]-(t[2]||0)))<=r.precision},intersects:function(e){return void 0===e.direction&&void 0===e.normal?null:!this.isParallelTo(e)},intersectionWith:function(e){if(!this.intersects(e))return null;if(e.direction){var t=e.anchor.elements,n=e.direction.elements,i=this.anchor.elements,s=((l=this.normal.elements)[0]*(i[0]-t[0])+l[1]*(i[1]-t[1])+l[2]*(i[2]-t[2]))/(l[0]*n[0]+l[1]*n[1]+l[2]*n[2]);return r.Vector.create([t[0]+n[0]*s,t[1]+n[1]*s,t[2]+n[2]*s])}if(e.normal){for(var a=this.normal.cross(e.normal).toUnitVector(),l=this.normal.elements,o=(t=this.anchor.elements,e.normal.elements),c=e.anchor.elements,h=r.Matrix.Zero(2,2),u=0;h.isSingular();)u++,h=r.Matrix.create([[l[u%3],l[(u+1)%3]],[o[u%3],o[(u+1)%3]]]);for(var f=h.inverse().elements,m=l[0]*t[0]+l[1]*t[1]+l[2]*t[2],d=o[0]*c[0]+o[1]*c[1]+o[2]*c[2],p=[f[0][0]*m+f[0][1]*d,f[1][0]*m+f[1][1]*d],v=[],g=1;g<=3;g++)v.push(u===g?0:p[(g+(5-u)%3)%3]);return r.Line.create(v,a)}},pointClosestTo:function(e){var t=e.elements||e,n=this.anchor.elements,i=this.normal.elements,s=(n[0]-t[0])*i[0]+(n[1]-t[1])*i[1]+(n[2]-(t[2]||0))*i[2];return r.Vector.create([t[0]+i[0]*s,t[1]+i[1]*s,(t[2]||0)+i[2]*s])},rotate:function(e,t){var n=e.determinant?e.elements:r.Matrix.Rotation(e,t.direction).elements,i=t.pointClosestTo(this.anchor).elements,s=this.anchor.elements,a=this.normal.elements,l=i[0],o=i[1],c=i[2],h=s[0]-l,u=s[1]-o,f=s[2]-c;return r.Plane.create([l+n[0][0]*h+n[0][1]*u+n[0][2]*f,o+n[1][0]*h+n[1][1]*u+n[1][2]*f,c+n[2][0]*h+n[2][1]*u+n[2][2]*f],[n[0][0]*a[0]+n[0][1]*a[1]+n[0][2]*a[2],n[1][0]*a[0]+n[1][1]*a[1]+n[1][2]*a[2],n[2][0]*a[0]+n[2][1]*a[1]+n[2][2]*a[2]])},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.normal.elements,i=t[0],s=t[1],a=t[2],l=n[0],o=n[1],c=n[2],h=this.anchor.reflectionIn(e).elements,u=i+l,f=s+o,m=a+c,d=e.pointClosestTo([u,f,m]).elements,p=[d[0]+(d[0]-u)-h[0],d[1]+(d[1]-f)-h[1],d[2]+(d[2]-m)-h[2]];return r.Plane.create(h,p)}if(e.direction)return this.rotate(Math.PI,e);var v=e.elements||e;return r.Plane.create(this.anchor.reflectionIn([v[0],v[1],v[2]||0]),this.normal)},setVectors:function(e,t,n){if(null===(e=(e=r.Vector.create(e)).to3D()))return null;if(null===(t=(t=r.Vector.create(t)).to3D()))return null;if(void 0===n)n=null;else if(null===(n=(n=r.Vector.create(n)).to3D()))return null;var i,s,a=e.elements[0],l=e.elements[1],o=e.elements[2],c=t.elements[0],h=t.elements[1],u=t.elements[2];if(null!==n){var f=n.elements[0],m=n.elements[1],d=n.elements[2];if(0===(s=(i=r.Vector.create([(h-l)*(d-o)-(u-o)*(m-l),(u-o)*(f-a)-(c-a)*(d-o),(c-a)*(m-l)-(h-l)*(f-a)])).modulus()))return null;i=r.Vector.create([i.elements[0]/s,i.elements[1]/s,i.elements[2]/s])}else{if(0===(s=Math.sqrt(c*c+h*h+u*u)))return null;i=r.Vector.create([t.elements[0]/s,t.elements[1]/s,t.elements[2]/s])}return this.anchor=e,this.normal=i,this}},r.Plane.create=function(e,t,n){return(new r.Plane).setVectors(e,t,n)};r.Plane.create;for(var i in r.Plane.XY=r.Plane.create(r.Vector.Zero(3),r.Vector.k),r.Plane.YZ=r.Plane.create(r.Vector.Zero(3),r.Vector.i),r.Plane.ZX=r.Plane.create(r.Vector.Zero(3),r.Vector.j),r.Plane.YX=r.Plane.XY,r.Plane.ZY=r.Plane.YZ,r.Plane.XZ=r.Plane.ZX,r.Plane.fromPoints=function(e){var t,n,i,s,a,l,o,c,h,u,f=e.length,m=[],d=r.Vector.Zero(3);for(t=0;t<f;t++){if(null===(n=r.Vector.create(e[t]).to3D()))return null;if(m.push(n),(i=m.length)>2){if(a=m[i-1].elements,l=m[i-2].elements,o=m[i-3].elements,s=r.Vector.create([(a[1]-l[1])*(o[2]-l[2])-(a[2]-l[2])*(o[1]-l[1]),(a[2]-l[2])*(o[0]-l[0])-(a[0]-l[0])*(o[2]-l[2]),(a[0]-l[0])*(o[1]-l[1])-(a[1]-l[1])*(o[0]-l[0])]).toUnitVector(),i>3&&null!==(h=s.angleFrom(u))&&!(Math.abs(h)<=r.precision||Math.abs(h-Math.PI)<=r.precision))return null;d=d.add(s),u=s}}return a=m[1].elements,l=m[0].elements,o=m[i-1].elements,c=m[i-2].elements,d=d.add(r.Vector.create([(a[1]-l[1])*(o[2]-l[2])-(a[2]-l[2])*(o[1]-l[1]),(a[2]-l[2])*(o[0]-l[0])-(a[0]-l[0])*(o[2]-l[2]),(a[0]-l[0])*(o[1]-l[1])-(a[1]-l[1])*(o[0]-l[0])]).toUnitVector()).add(r.Vector.create([(l[1]-o[1])*(c[2]-o[2])-(l[2]-o[2])*(c[1]-o[1]),(l[2]-o[2])*(c[0]-o[0])-(l[0]-o[0])*(c[2]-o[2]),(l[0]-o[0])*(c[1]-o[1])-(l[1]-o[1])*(c[0]-o[0])]).toUnitVector()),r.Plane.create(m[0],d)},r.Polygon=function(){},r.Polygon.prototype={v:function(e){return this.vertices.at(e-1).data},nodeFor:function(e){return this.vertices.withData(e)},dup:function(){return r.Polygon.create(this.vertices,this.plane)},translate:function(e){var t=e.elements||e;return this.vertices.each(function(e){var n=e.data.elements;e.data.setElements([n[0]+t[0],n[1]+t[1],n[2]+(t[2]||0)])}),this.plane=this.plane.translate(e),this.updateTrianglePlanes(function(t){return t.translate(e)}),this},rotate:function(e,t){var n=r.Matrix.Rotation(e,t.direction);return this.vertices.each(function(e){e.data.setElements(e.data.rotate(n,t).elements)}),this.plane=this.plane.rotate(n,t),this.updateTrianglePlanes(function(e){return e.rotate(n,t)}),this},scale:function(e,t){var n=t.elements||t;this.vertices.each(function(t){var r=t.data.elements;t.data.setElements([n[0]+e*(r[0]-n[0]),n[1]+e*(r[1]-n[1]),(n[2]||0)+e*(r[2]-(n[2]||0))])});var i=this.vertices.first.data;return this.plane.anchor.setElements(i),this.updateTrianglePlanes(function(e){return r.Plane.create(i,e.normal)}),this},updateTrianglePlanes:function(e){var t;if(null!==this.cached.triangles)for(t=this.cached.triangles.length;t--;)this.cached.triangles[t].plane=e(this.cached.triangles[t].plane);if(null!==this.cached.surfaceIntegralElements)for(t=this.cached.surfaceIntegralElements.length;t--;)this.cached.surfaceIntegralElements[t].plane=e(this.cached.surfaceIntegralElements[t].plane)},isTriangle:function(){return 3===this.vertices.length},trianglesForSurfaceIntegral:function(){if(null!==this.cached.surfaceIntegralElements)return this.cached.surfaceIntegralElements;var e=[],t=this.vertices.first.data,n=this.plane;return this.vertices.each(function(i,s){if(!(s<2)){var a=[t,i.prev.data,i.data];e.push(r.Polygon.create(a,r.Plane.fromPoints(a)||n))}}),this.setCache("surfaceIntegralElements",e)},area:function(){if(this.isTriangle()){var e=this.vertices.first,t=e.next,n=t.next;return e=e.data.elements,t=t.data.elements,n=n.data.elements,.5*r.Vector.create([(e[1]-t[1])*(n[2]-t[2])-(e[2]-t[2])*(n[1]-t[1]),(e[2]-t[2])*(n[0]-t[0])-(e[0]-t[0])*(n[2]-t[2]),(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])]).modulus()}for(var i=this.trianglesForSurfaceIntegral(),s=0,a=i.length;a--;)s+=i[a].area()*i[a].plane.normal.dot(this.plane.normal);return s},centroid:function(){if(this.isTriangle()){var e=this.v(1).elements,t=this.v(2).elements,n=this.v(3).elements;return r.Vector.create([(e[0]+t[0]+n[0])/3,(e[1]+t[1]+n[1])/3,(e[2]+t[2]+n[2])/3])}for(var i,s=0,a=r.Vector.Zero(3),l=this.trianglesForSurfaceIntegral(),o=l.length;o--;)s+=e=l[o].area()*l[o].plane.normal.dot(this.plane.normal),i=a.elements,n=l[o].centroid().elements,a.setElements([i[0]+n[0]*e,i[1]+n[1]*e,i[2]+n[2]*e]);return a.x(1/s)},projectionOn:function(e){var t=[];return this.vertices.each(function(n){t.push(e.pointClosestTo(n.data))}),r.Polygon.create(t)},removeVertex:function(e){if(!this.isTriangle()){var t=this.nodeFor(e);if(null===t)return null;this.clearCache();var n=t.prev,i=t.next,s=n.data.isConvex(this),a=i.data.isConvex(this);return t.data.isConvex(this)?this.convexVertices.remove(this.convexVertices.withData(t.data)):this.reflexVertices.remove(this.reflexVertices.withData(t.data)),this.vertices.remove(t),s!==n.data.isConvex(this)&&(s?(this.convexVertices.remove(this.convexVertices.withData(n.data)),this.reflexVertices.append(new r.LinkedList.Node(n.data))):(this.reflexVertices.remove(this.reflexVertices.withData(n.data)),this.convexVertices.append(new r.LinkedList.Node(n.data)))),a!==i.data.isConvex(this)&&(a?(this.convexVertices.remove(this.convexVertices.withData(i.data)),this.reflexVertices.append(new r.LinkedList.Node(i.data))):(this.reflexVertices.remove(this.reflexVertices.withData(i.data)),this.convexVertices.append(new r.LinkedList.Node(i.data)))),this}},contains:function(e){return this.containsByWindingNumber(e)},containsByWindingNumber:function(e){var t=e.elements||e;if(!this.plane.contains(t))return!1;if(this.hasEdgeContaining(t))return!1;var n,i,s,a,l,o=0,c=0,h=this;return this.vertices.each(function(e){n=e.data.elements,i=e.next.data.elements,s=r.Vector.create([n[0]-t[0],n[1]-t[1],n[2]-(t[2]||0)]),a=r.Vector.create([i[0]-t[0],i[1]-t[1],i[2]-(t[2]||0)]),null!==(l=s.angleFrom(a))&&0!==l&&((o+=(s.cross(a).isParallelTo(h.plane.normal)?1:-1)*l)>=2*Math.PI-r.precision&&(c++,o-=2*Math.PI),o<=-2*Math.PI+r.precision&&(c--,o+=2*Math.PI))}),0!==c},hasEdgeContaining:function(e){var t=e.elements||e,n=!1;return this.vertices.each(function(e){r.Line.Segment.create(e.data,e.next.data).contains(t)&&(n=!0)}),n},toTriangles:function(){return null!==this.cached.triangles?this.cached.triangles:this.setCache("triangles",this.triangulateByEarClipping())},triangulateByEarClipping:function(){for(var e,t,n,i,s=this.dup(),a=[];!s.isTriangle();){for(e=!1;!e;)e=!0,t=s.convexVertices.randomNode(),n=s.vertices.withData(t.data),i=r.Polygon.create([n.data,n.next.data,n.prev.data],this.plane),s.reflexVertices.each(function(t){t.data!==n.prev.data&&t.data!==n.next.data&&(i.contains(t.data)||i.hasEdgeContaining(t.data))&&(e=!1)});a.push(i),s.removeVertex(n.data)}return a.push(r.Polygon.create(s.vertices,this.plane)),a},setVertices:function(e,t){var n=e.toArray?e.toArray():e;if(this.plane=t&&t.normal?t.dup():r.Plane.fromPoints(n),null===this.plane)return null;this.vertices=new r.LinkedList.Circular;for(var i,s=n.length;s--;)i=n[s].isConvex?n[s]:new r.Polygon.Vertex(n[s]),this.vertices.prepend(new r.LinkedList.Node(i));return this.clearCache(),this.populateVertexTypeLists(),this},populateVertexTypeLists:function(){this.convexVertices=new r.LinkedList.Circular,this.reflexVertices=new r.LinkedList.Circular;var e=this;this.vertices.each(function(t){e[t.data.type(e)+"Vertices"].append(new r.LinkedList.Node(t.data))})},copyVertices:function(){this.clearCache(),this.vertices.each(function(e){e.data=new r.Polygon.Vertex(e.data)}),this.populateVertexTypeLists()},clearCache:function(){this.cached={triangles:null,surfaceIntegralElements:null}},setCache:function(e,t){return this.cached[e]=t,t},inspect:function(){var e=[];return this.vertices.each(function(t){e.push(t.data.inspect())}),e.join(" -> ")}},r.Polygon.create=function(e,t){return(new r.Polygon).setVertices(e,t)},r.Polygon.Vertex=function(e){if(this.setElements(e),2===this.elements.length&&this.elements.push(0),3!==this.elements.length)return null},r.Polygon.Vertex.prototype=new r.Vector,r.Polygon.Vertex.prototype.isConvex=function(e){var t=e.nodeFor(this);if(null===t)return null;var n=t.prev.data,i=t.next.data.subtract(this),s=n.subtract(this),a=i.angleFrom(s);return a<=r.precision||!(Math.abs(a-Math.PI)<=r.precision)&&i.cross(s).dot(e.plane.normal)>0},r.Polygon.Vertex.prototype.isReflex=function(e){var t=this.isConvex(e);return null===t?null:!t},r.Polygon.Vertex.prototype.type=function(e){var t=this.isConvex(e);return null===t?null:t?"convex":"reflex"},r.Polygon.Vertex.convert=function(e){for(var t=e.toArray?e.toArray():e,n=[],i=t.length,s=0;s<i;s++)n.push(new r.Polygon.Vertex(t[s]));return n},r.LinkedList=function(){},r.LinkedList.prototype={length:0,first:null,last:null,forEach:function(e,t){for(var n=this.first,r=this.length,i=0;i<r;i++)e.call(t,n,i),n=n.next},at:function(e){if(!(e>=0&&e<this.length))return null;for(var t=this.first;e--;)t=t.next;return t},randomNode:function(){var e=Math.floor(Math.random()*this.length);return this.at(e)},toArray:function(){for(var e=[],t=this.first,n=this.length;n--;)e.push(t.data||t),t=t.next;return e}},r.LinkedList.prototype.each=r.LinkedList.prototype.forEach,r.LinkedList.Node=function(e){this.prev=null,this.next=null,this.data=e},r.LinkedList.Circular=function(){},r.LinkedList.Circular.Methods={append:function(e){null===this.first?(e.prev=e,e.next=e,this.first=e,this.last=e):(e.prev=this.last,e.next=this.first,this.first.prev=e,this.last.next=e,this.last=e),this.length++},prepend:function(e){null!==this.first?(e.prev=this.last,e.next=this.first,this.first.prev=e,this.last.next=e,this.first=e,this.length++):this.append(e)},insertAfter:function(e,t){t.prev=e,t.next=e.next,e.next.prev=t,e.next=t,t.prev===this.last&&(this.last=t),this.length++},insertBefore:function(e,t){t.prev=e.prev,t.next=e,e.prev.next=t,e.prev=t,t.next===this.first&&(this.first=t),this.length++},remove:function(e){this.length>1?(e.prev.next=e.next,e.next.prev=e.prev,e===this.first&&(this.first=e.next),e===this.last&&(this.last=e.prev)):(this.first=null,this.last=null),e.prev=null,e.next=null,this.length--},withData:function(e){for(var t=this.first,n=this.last,r=Math.ceil(this.length/2);r--;){if(t.data===e)return t;if(n.data===e)return n;t=t.next,n=n.prev}return null}},r.LinkedList.Circular.prototype=new r.LinkedList,r.LinkedList.Circular.Methods)r.LinkedList.Circular.prototype[i]=r.LinkedList.Circular.Methods[i];r.LinkedList.Circular.fromArray=function(e,t){for(var n=new r.LinkedList.Circular,i=e.length;i--;)n.prepend(t?new r.LinkedList.Node(e[i]):e[i]);return n},function(){var e=t;e.Line=r.Line,e.Matrix=r.Matrix,e.Plane=r.Plane,e.Polygon=r.Polygon,e.Vector=r.Vector,"undefined"!=typeof WScript&&(this.Sylvester=r)}()}});